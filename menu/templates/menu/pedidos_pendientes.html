{% extends 'admin/base_site.html' %}
{% block title %}Platos pendientes{% endblock %}
{% block content %}
<h1>Platos pendientes</h1>

<table id="tabla-pedidos">
    <thead>
        <tr>
            <th>Pedido #</th>
            <th>Mesa</th>
            <th>Hora</th>
            <th>Platos</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for pedido in pedidos %}
        <tr id="pedido-{{ pedido.id }}">
            <td>{{ pedido.id }}</td>
            <td>{{ pedido.mesa }}</td>
            <td>{{ pedido.hora_pedido|time:"H:i" }}</td>  <td>
                <ul>
                    {% for pedidoplato in pedido.pedidoplato_set.all %}
                    <li>{{ pedidoplato.plato.nombre }} x {{ pedidoplato.cantidad }}</li>
                    {% endfor %}
                </ul>
            </td>
            <td>
                <form method="post" action="{% url 'menu:cambiar_estado_pedido' pedido.id %}">
                    {% csrf_token %}
                    <select name="estado">
                        <option value="pendiente" {% if pedido.estado == 'pendiente' %}selected{% endif %}>Pendiente</option>
                        <option value="preparando" {% if pedido.estado == 'preparando' %}selected{% endif %}>Preparando</option>
                        <option value="entregado" {% if pedido.estado == 'entregado' %}selected{% endif %}>Entregado</option>
                        <option value="cancelado" {% if pedido.estado == 'cancelado' %}selected{% endif %}>Cancelado</option>
                    </select>
                    <button type="submit">Cambiar</button>
                </form>
            </td>
            <td>
                <a href="{% url 'menu:marcar_como_finalizado' pedido.id %}">Marcar como finalizado</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    function actualizarPedidos() {
        $.ajax({
            url: '/menu/pedidos_pendientes/',
            dataType: 'html',
            success: function(data) {
                $('#tabla-pedidos').html($(data).find('#tabla-pedidos').html());
            }
        });
    }

    setInterval(actualizarPedidos, 15000);
</script>
{% endblock %}